<html>

<head>
  <title>Test Runner</title>
</head>

<body>
  <script type="module">
    import { runTests } from '@web/test-runner-mocha';
    import { expect } from '@esm-bundle/chai';

    runTests(async () => {
      describe('HTML Index Tests', () => {

        it('empty test', () => {
          // empty test
          console.log('empty test');
        });
        it('can load rum enhancer as a script', async () => {
          let called = false;
          window.hlx = {
            rum: {
              sampleRUM: (...args) => {
                console.log('fake sampleRUM', ...args);
              }
            }
          };

          window.hlx.rum.sampleRUM.drain = (...args) => {
            console.log('fake drain', ...args);
            called = true;
          };


          const script = document.createElement('script');
          script.src = new URL('/src/index.js', window.location).href;
          document.head.appendChild(script);

          await new Promise((resolve) => {
            script.onload = resolve;
          });
          expect(called).to.be.true;
        });

      });
    });
  </script>
</body>

</html>